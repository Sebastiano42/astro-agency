---
// src/components/RippleEffect.astro
// Creates elegant dual-ring ripple effects on click - desktop only
---

<script>
  const MAX_RIPPLES = 4;
  let clickHandler = null;

  function cleanupRipple() {
    if (clickHandler) {
      document.removeEventListener('click', clickHandler);
      clickHandler = null;
    }
  }

  function initRippleEffect() {
    cleanupRipple();

    const isTouchDevice = ('ontouchstart' in window) || (navigator.maxTouchPoints > 0);
    if (isTouchDevice) return;

    const createRipple = (x, y) => {
      const existingRipples = document.querySelectorAll('.ripple');
      if (existingRipples.length >= MAX_RIPPLES) {
        existingRipples[0].remove();
      }

      // Outer ring ripple
      const ripple = document.createElement('div');
      ripple.className = 'ripple';
      ripple.style.left = `${x}px`;
      ripple.style.top = `${y}px`;
      ripple.style.width = '16px';
      ripple.style.height = '16px';
      ripple.style.marginLeft = '-8px';
      ripple.style.marginTop = '-8px';
      document.body.appendChild(ripple);

      // Inner ring ripple (delayed, faster)
      const inner = document.createElement('div');
      inner.className = 'ripple ripple-inner';
      inner.style.left = `${x}px`;
      inner.style.top = `${y}px`;
      inner.style.width = '8px';
      inner.style.height = '8px';
      inner.style.marginLeft = '-4px';
      inner.style.marginTop = '-4px';
      document.body.appendChild(inner);

      ripple.addEventListener('animationend', () => ripple.remove(), { once: true });
      inner.addEventListener('animationend', () => inner.remove(), { once: true });
    };

    clickHandler = (e) => { createRipple(e.clientX, e.clientY); };
    document.addEventListener('click', clickHandler);
  }

  document.addEventListener('astro:page-load', initRippleEffect);
  document.addEventListener('astro:before-swap', cleanupRipple);
</script>
