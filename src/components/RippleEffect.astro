---
// src/components/RippleEffect.astro
// Creates beautiful ripple effects on click - desktop only
---

<script>
  const MAX_RIPPLES = 3;
  let clickHandler = null;

  function cleanupRipple() {
    if (clickHandler) {
      document.removeEventListener('click', clickHandler);
      clickHandler = null;
    }
  }

  function initRippleEffect() {
    cleanupRipple();

    // Disable ripple entirely on touch devices - it adds DOM on touchstart
    // which delays navigation and causes perceived lag
    const isTouchDevice = ('ontouchstart' in window) || (navigator.maxTouchPoints > 0);
    if (isTouchDevice) return;

    const createRipple = (x, y) => {
      const existingRipples = document.querySelectorAll('.ripple');
      if (existingRipples.length >= MAX_RIPPLES) {
        existingRipples[0].remove();
      }

      const ripple = document.createElement('div');
      ripple.className = 'ripple';
      ripple.style.left = `${x}px`;
      ripple.style.top = `${y}px`;
      ripple.style.width = '20px';
      ripple.style.height = '20px';
      ripple.style.marginLeft = '-10px';
      ripple.style.marginTop = '-10px';

      document.body.appendChild(ripple);

      ripple.addEventListener('animationend', () => {
        ripple.remove();
      }, { once: true });
    };

    clickHandler = (e) => { createRipple(e.clientX, e.clientY); };
    document.addEventListener('click', clickHandler);
  }

  document.addEventListener('astro:page-load', initRippleEffect);
  document.addEventListener('astro:before-swap', cleanupRipple);
</script>
